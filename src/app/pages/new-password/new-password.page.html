<!-- src/app/pages/new-password/new-password.page.html -->
<ion-content class="login-content" [fullscreen]="true">
  <div class="login-wrapper">

    <div class="logo-section">
      <img src="assets/ars-logo.png" alt="ARS Green Steel" class="logo" />
    </div>

    <div class="auth-card">

      @if (!isSuccess) {
        <h1 class="auth-title">Create New Password</h1>
        <p class="auth-subtitle">Choose a strong password for your account security</p>

        <form [formGroup]="form" (ngSubmit)="onSubmit()">

          <!-- New Password -->
          <div class="field-group">
            <label class="field-label">New Password</label>
            <div class="input-wrapper" [class.error]="newPassword.invalid && newPassword.touched">
              <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
              <input [type]="showNew ? 'text' : 'password'" formControlName="newPassword"
                     placeholder="Enter your new password" class="ars-input" />
              <ion-icon [name]="showNew ? 'eye-off-outline' : 'eye-outline'"
                        class="toggle-icon" (click)="showNew = !showNew"></ion-icon>
            </div>
            @if (newPassword.invalid && newPassword.touched) {
              <span class="field-error">Password must be at least 8 characters</span>
            }
          </div>

          <!-- Confirm Password -->
          <div class="field-group">
            <label class="field-label">Confirm Password</label>
            <div class="input-wrapper" [class.error]="hasMismatch">
              <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
              <input [type]="showConfirm ? 'text' : 'password'" formControlName="confirmPassword"
                     placeholder="Enter your new password" class="ars-input" />
              <ion-icon [name]="showConfirm ? 'eye-off-outline' : 'eye-outline'"
                        class="toggle-icon" (click)="showConfirm = !showConfirm"></ion-icon>
            </div>
            @if (hasMismatch) {
              <span class="field-error">Passwords do not match</span>
            }
          </div>

          <button type="submit" class="ars-btn-primary" [disabled]="isLoading">
            @if (isLoading) { <ion-spinner name="crescent" color="light"></ion-spinner> }
            @else { Update Password }
          </button>

          <p class="hint-text">Make sure to use a password you haven't used before</p>
        </form>
      }

      @if (isSuccess) {
        <div class="success-state">
          <ion-icon name="checkmark-circle-outline" class="success-icon"></ion-icon>
          <h2>Password Updated!</h2>
          <p>Redirecting you to sign in...</p>
        </div>
      }
    </div>

    <p class="copyright">Â© 2026 ARS Steel. All rights reserved.</p>
  </div>
</ion-content>
